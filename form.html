<!DOCTYPE html>
<html>

<head>
  <title>BCIEP Phase 1 Tracker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 1300px;
      background: #f9f9f9;
    }

    h2 {
      text-align: center;
      margin-top: 40px;
      background-color: #003366;
      color: #fff;
      padding: 10px;
      border-radius: 5px;
    }

    .form-container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: space-between;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      flex: 1;
      min-width: 300px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #003366;
      color: white;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 5px;
    }

    button:hover {
      background-color: #005299;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 13px;
      text-align: left;
    }

    th {
      background-color: #e0e0e0;
    }

    .error-message {
      color: red;
      font-weight: bold;
    }

    .presentation-upload-form-container {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .presentation-week-group,
    .media-week-group {
      margin-bottom: 30px;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .presentation-week-group h3,
    .media-week-group h3 {
      text-align: left;
      background: #004a99;
      color: #fff;
      padding: 10px 15px;
      border-radius: 5px;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.3em;
    }

    .presentation-week-group h4,
    .media-week-group h4 {
      margin-top: 15px;
      margin-bottom: 10px;
      color: #333;
      font-size: 1.1em;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
    }


    .presentation-item {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px dashed #eee;
    }

    .presentation-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .presentation-container {
      position: relative;
      width: 100%;
      max-width: 100%;
      padding-top: 56.25%;
      height: 0;
      overflow: hidden;
      margin: 10px auto;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .presentation-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .navigation-buttons {
      text-align: center;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .delete-button {
      background-color: #d9534f;
      color: white;
      padding: 6px 12px;
      font-size: 0.9em;
      border-radius: 4px;
      cursor: pointer;
      border: none;
      margin-top: 10px;
      display: inline-block;
    }

    .delete-button:hover {
      background-color: #c9302c;
    }
  </style>
</head>

<body>
  <div class="navigation-buttons">
    <button onclick="showSection('meetings-section')">Meetings</button>
    <button onclick="showSection('weeklyStatus-section')">Weekly Status</button>
    <button onclick="showSection('media-section')">Media</button>
    <button onclick="showSection('presentations-section')">Presentation</button>
    <button onclick="showSection('dummy4-section')">Dummy 4</button>
  </div>

  <div id="meetings-section" style="display: none;">
    <h2>Bloomberg Cities Idea Exchange || India || Meeting & Action Tracker</h2>
    <div class="form-container">
      <form id="meeting-form" style="margin-top: 0; border: 2px solid #ccc;">
        <h3 style="margin-top: 0px;">Meeting Agenda and Discussions</h3>
        <div id="meeting-mode"
          style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5; font-weight: bold; color: #d9534f;">
          Mode: Add New Meeting</div>
        <input type="hidden" name="row">
        <div class="form-grid">
          <div><label>Meeting ID:</label><input type="text" name="meetingId" id="meetingId" readonly></div>
          <div><label>Meeting Date:</label><input type="date" name="meetingDate" required>
          </div>
          <div><label>Zone:</label><select name="zone" required>
              <option value="">Select Zone</option>
              <option>Zone 1</option>
              <option>Zone 2</option>
              <option>Zone 3</option>
            </select></div>
          <div><label>District:</label><select name="district" required>
              <option value="">Select District</option>
              <option>Balangir</option>
              <option>Bargarh</option>
              <option>Cuttack</option>
              <option>Ganjam</option>
              <option>Kendujhar</option>
              <option>Koraput</option>
              <option>Mayurbhanj</option>
              <option>Sambalpur</option>
              <option>Sundargarh</option>
            </select></div>
          <div><label>Cold Room Location (Optional):</label><select name="coldRoom">
              <option value="">None</option>
              <option>Besil</option>
              <option>RMC Behera Market</option>
              <option>RMC Sarandapali</option>
              <option>Athagarh NAC</option>
              <option>Nistipur</option>
              <option>Dudhianali</option>
              <option>RMC Kalabada Market Yard</option>
              <option>RMC Digapahandi Market Yard</option>
              <option>RMC Bhanjanagar Market Yard</option>
              <option>Bahadapada</option>
              <option>RMC Buguda Market Yard</option>
              <option>Chatrapur Market</option>
              <option>Kolasingi</option>
              <option>Raisuan</option>
              <option>Madarangajodi</option>
              <option>Mukuna</option>
              <option>Tikarapada</option>
              <option>Nuagaon (Narsinghpur)</option>
              <option>Baradapala,</option>
              <option>Ratanpur</option>
              <option>Tulasichaura</option>
              <option>Kathakaranjia</option>
              <option>Ghatabhagra</option>
              <option>Malimarla</option>
              <option>Baghiatangar</option>
              <option>Chapaldihi</option>
              <option>Akhapolan</option>
              <option>Sandhenkia</option>
              <option>Tikhia</option>
              <option>Kuchinda</option>
              <option>Bhojpur</option>
              <option>T.Niktimal</option>
              <option>Charmal</option>
              <option>Khetrajpur</option>
              <option>Kardega</option>
              <option>Kadalidhipa</option>
              <option>Khariapada</option>
              <option>Bhelluadihi</option>
              <option>Domposh</option>
              <option>Rajpur</option>
              <option>Kansar</option>
            </select></div>
          <div class="full-width"><label>Meeting Title:</label><input type="text" name="meetingTitle" required></div>
          <div><label>Conducted By:</label><select name="conductedBy" required>
              <option>Akshaya Kumar Pallai</option>
              <option>Vicky Vikram Das</option>
              <option>Krushna Chandra Parida</option>
              <option>Mary Helena Kujur</option>
              <option>Hemanti Sabar</option>
              <option>Amlan Abhinav</option>
              <option>Asutosh Nayak</option>
              <option>Pratham Parida</option>
              <option>Rashmi Prava Nayak</option>
              <option>Minati Mallick</option>
              <option>Sunita Patra</option>
              <option>Deepak Kumar Tudu</option>
              <option>Swati Rani Achary</option>
            </select></div>
          <div><label>Attendees:</label><textarea name="attendees" required></textarea></div>
          <div class="full-width"><label>Meeting Agenda:</label><textarea name="meetingAgenda" required></textarea>
          </div>
          <div class="full-width"><label>What points were discussed during the meeting?</label><textarea
              name="meetingDiscussion"></textarea></div>
        </div>
        <button type="submit">Save Meeting</button>
      </form>

      <form id="action-form" style="margin-top: 0; border: 2px solid #ccc;">
        <h3 style="margin-top: 0px;">Meeting Action Items</h3>
        <div id="action-mode"
          style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5; font-weight: bold; color: #d9534f;">
          Mode: Add New Action Item
        </div>
        <input type="hidden" name="row">
        <div class="form-grid">
          <div><label>Meeting ID:</label><input type="text" name="meetingId" id="action-meetingId" readonly required>
          </div>
          <div class="full-width"><label>Action Item:</label><input type="text" name="actionItem" required></div>
          <div><label>Assigned To:</label><select name="assignedTo" required>
              <option>Akshaya Kumar Pallai</option>
              <option>Vicky Vikram Das</option>
              <option>Krushna Chandra Parida</option>
              <option>Mary Helena Kujur</option>
              <option>Hemanti Sabar</option>
              <option>Amlan Abhinav</option>
              <option>Asutosh Nayak</option>
              <option>Pratham Parida</option>
              <option>Rashmi Prava Nayak</option>
              <option>Minati Mallick</option>
              <option>Sunita Patra</option>
              <option>Deepak Kumar Tudu</option>
              <option>Swati Rani Achary</option>
            </select></div>
          <div><label>Deadline:</label><input type="date" name="deadline" required></div>
          <div class="full-width"><label>Status:</label><select name="status" required>
              <option value="">Select Status</option>
              <option>Pending</option>
              <option>In Progress</option>
              <option>Completed</option>
            </select></div>
        </div>
        <button type="submit">Add Action Item</button>
        <button type="reset">Clear</button>
      </form>
    </div>
    <h2 style="text-align: center; margin-top: 20px">All Meetings</h2>
    <table id="meeting-table">
      <thead></thead>
      <tbody></tbody>
    </table>

    <h2 style="text-align: center;">All Action Items</h2>
    <table id="action-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="weeklyStatus-section" style="display:none;">
    <h2 style="text-align:center; background:#0b2d64; color:white; padding:10px; border-radius:5px;">
      Bloomberg Cities Idea Exchange || India || Weekly Status
    </h2>

    <form id="weekly-status-form"
      style="margin:0 auto; background:white; padding:20px; border-radius:6px; border:2px solid #ccc;">
      <input type="hidden" name="row">
      <h3>Enter Weekly Status</h3>
      <div id="status-mode"
        style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5; font-weight: bold; color: #d9534f;">
        Mode: Add New Status</div>
      <label>Week Number:</label>
      <select name="weekInfo" required>
        <option value="">Select Week</option>
        <option value="Week 19 (May 05 - May 11)">Week 19 (May 05 - May 11)</option>
        <option value="Week 20 (May 12 - May 18)">Week 20 (May 12 - May 18)</option>
        <option value="Week 21 (May 19 - May 25)">Week 21 (May 19 - May 25)</option>
        <option value="Week 22 (May 26 - Jun 01)">Week 22 (May 26 - Jun 01)</option>
        <option value="Week 23 (Jun 02 - Jun 08)">Week 23 (Jun 02 - Jun 08)</option>
        <option value="Week 24 (Jun 09 - Jun 15)">Week 24 (Jun 09 - Jun 15)</option>
        <option value="Week 25 (Jun 16 - Jun 22)">Week 25 (Jun 16 - Jun 22)</option>
        <option value="Week 26 (Jun 23 - Jun 29)">Week 26 (Jun 23 - Jun 29)</option>
        <option value="Week 27 (Jun 30 - Jul 06)">Week 27 (Jun 30 - Jul 06)</option>
        <option value="Week 28 (Jul 07 - Jul 13)">Week 28 (Jul 07 - Jul 13)</option>
        <option value="Week 29 (Jul 14 - Jul 20)">Week 29 (Jul 14 - Jul 20)</option>
        <option value="Week 30 (Jul 21 - Jul 27)">Week 30 (Jul 21 - Jul 27)</option>
        <option value="Week 31 (Jul 28 - Aug 03)">Week 31 (Jul 28 - Aug 03)</option>
        <option value="Week 32 (Aug 04 - Aug 10)">Week 32 (Aug 04 - Aug 10)</option>
        <option value="Week 33 (Aug 11 - Aug 17)">Week 33 (Aug 11 - Aug 17)</option>
        <option value="Week 34 (Aug 18 - Aug 24)">Week 34 (Aug 18 - Aug 24)</option>
        <option value="Week 35 (Aug 25 - Aug 31)">Week 35 (Aug 25 - Aug 31)</option>
        <option value="Week 36 (Sep 01 - Sep 07)">Week 36 (Sep 01 - Sep 07)</option>
        <option value="Week 37 (Sep 08 - Sep 14)">Week 37 (Sep 08 - Sep 14)</option>
        <option value="Week 38 (Sep 15 - Sep 21)">Week 38 (Sep 15 - Sep 21)</option>
        <option value="Week 39 (Sep 22 - Sep 28)">Week 39 (Sep 22 - Sep 28)</option>
        <option value="Week 40 (Sep 29 - Oct 05)">Week 40 (Sep 29 - Oct 05)</option>
        <option value="Week 41 (Oct 06 - Oct 12)">Week 41 (Oct 06 - Oct 12)</option>
        <option value="Week 42 (Oct 13 - Oct 19)">Week 42 (Oct 13 - Oct 19)</option>
        <option value="Week 43 (Oct 20 - Oct 26)">Week 43 (Oct 20 - Oct 26)</option>
        <option value="Week 44 (Oct 27 - Nov 02)">Week 44 (Oct 27 - Nov 02)</option>
        <option value="Week 45 (Nov 03 - Nov 09)">Week 45 (Nov 03 - Nov 09)</option>
        <option value="Week 46 (Nov 10 - Nov 16)">Week 46 (Nov 10 - Nov 16)</option>
        <option value="Week 47 (Nov 17 - Nov 23)">Week 47 (Nov 17 - Nov 23)</option>
        <option value="Week 48 (Nov 24 - Nov 30)">Week 48 (Nov 24 - Nov 30)</option>
        <option value="Week 49 (Dec 01 - Dec 07)">Week 49 (Dec 01 - Dec 07)</option>
        <option value="Week 50 (Dec 08 - Dec 14)">Week 50 (Dec 08 - Dec 14)</option>
        <option value="Week 51 (Dec 15 - Dec 21)">Week 51 (Dec 15 - Dec 21)</option>
        <option value="Week 52 (Dec 22 - Dec 28)">Week 52 (Dec 22 - Dec 28)</option>
        <option value="Week 53 (Dec 29 - Dec 31)">Week 53 (Dec 29 - Dec 31)</option>
      </select>

      <label>Zone:</label>
      <select name="zone" required>
        <option value="">Select Zone</option>
        <option>Zone 1</option>
        <option>Zone 2</option>
        <option>Zone 3</option>
      </select>

      <label>District:</label>
      <select name="district" required>
        <option value="">Select District</option>
        <option>Balangir</option>
        <option>Bargarh</option>
        <option>Cuttack</option>
        <option>Ganjam</option>
        <option>Kendujhar</option>
        <option>Koraput</option>
        <option>Mayurbhanj</option>
        <option>Sambalpur</option>
        <option>Sundargarh</option>
      </select>

      <label>Summary of This Week Activities:</label>
      <textarea name="currentWeekUpdate" rows="3" required></textarea>

      <label>Activities Planned for Next Week:</label>
      <textarea name="nextWeekUpdate" rows="4" required></textarea>

      <button type="submit">Save Status</button>
    </form>
    <h2 style="text-align: center; margin-top: 20px">All Weekly Status</h2>
    <table id="weekly-status-table" style="margin:0 auto;">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="media-section" style="display:none; text-align:center;">
    <h2>Upload Weekly Media Files</h2>
    <form id="media-upload-form" method="post" enctype="multipart/form-data"
      style="max-width: 800px; margin:0 auto; border:2px solid #ccc; padding:20px; border-radius:8px;">
      <div class="form-grid">
        <div>
          <label>Week:</label>
          <select name="weekInfo" required>
            <option value="">Select Week</option>
            <option value="Week 19 (May 05 - May 11)">Week 19 (May 05 - May 11)</option>
            <option value="Week 20 (May 12 - May 18)">Week 20 (May 12 - May 18)</option>
            <option value="Week 21 (May 19 - May 25)">Week 21 (May 19 - May 25)</option>
            <option value="Week 22 (May 26 - Jun 01)">Week 22 (May 26 - Jun 01)</option>
            <option value="Week 23 (Jun 02 - Jun 08)">Week 23 (Jun 02 - Jun 08)</option>
            <option value="Week 24 (Jun 09 - Jun 15)">Week 24 (Jun 09 - Jun 15)</option>
            <option value="Week 25 (Jun 16 - Jun 22)">Week 25 (Jun 16 - Jun 22)</option>
            <option value="Week 26 (Jun 23 - Jun 29)">Week 26 (Jun 23 - Jun 29)</option>
            <option value="Week 27 (Jun 30 - Jul 06)">Week 27 (Jun 30 - Jul 06)</option>
            <option value="Week 28 (Jul 07 - Jul 13)">Week 28 (Jul 07 - Jul 13)</option>
            <option value="Week 29 (Jul 14 - Jul 20)">Week 29 (Jul 14 - Jul 20)</option>
            <option value="Week 30 (Jul 21 - Jul 27)">Week 30 (Jul 21 - Jul 27)</option>
            <option value="Week 31 (Jul 28 - Aug 03)">Week 31 (Jul 28 - Aug 03)</option>
            <option value="Week 32 (Aug 04 - Aug 10)">Week 32 (Aug 04 - Aug 10)</option>
            <option value="Week 33 (Aug 11 - Aug 17)">Week 33 (Aug 11 - Aug 17)</option>
            <option value="Week 34 (Aug 18 - Aug 24)">Week 34 (Aug 18 - Aug 24)</option>
            <option value="Week 35 (Aug 25 - Aug 31)">Week 35 (Aug 25 - Aug 31)</option>
            <option value="Week 36 (Sep 01 - Sep 07)">Week 36 (Sep 01 - Sep 07)</option>
            <option value="Week 37 (Sep 08 - Sep 14)">Week 37 (Sep 08 - Sep 14)</option>
            <option value="Week 38 (Sep 15 - Sep 21)">Week 38 (Sep 15 - Sep 21)</option>
            <option value="Week 39 (Sep 22 - Sep 28)">Week 39 (Sep 22 - Sep 28)</option>
            <option value="Week 40 (Sep 29 - Oct 05)">Week 40 (Sep 29 - Oct 05)</option>
            <option value="Week 41 (Oct 06 - Oct 12)">Week 41 (Oct 06 - Oct 12)</option>
            <option value="Week 42 (Oct 13 - Oct 19)">Week 42 (Oct 13 - Oct 19)</option>
            <option value="Week 43 (Oct 20 - Oct 26)">Week 43 (Oct 20 - Oct 26)</option>
            <option value="Week 44 (Oct 27 - Nov 02)">Week 44 (Oct 27 - Nov 02)</option>
            <option value="Week 45 (Nov 03 - Nov 09)">Week 45 (Nov 03 - Nov 09)</option>
            <option value="Week 46 (Nov 10 - Nov 16)">Week 46 (Nov 10 - Nov 16)</option>
            <option value="Week 47 (Nov 17 - Nov 23)">Week 47 (Nov 17 - Nov 23)</option>
            <option value="Week 48 (Nov 24 - Nov 30)">Week 48 (Nov 24 - Nov 30)</option>
            <option value="Week 49 (Dec 01 - Dec 07)">Week 49 (Dec 01 - Dec 07)</option>
            <option value="Week 50 (Dec 08 - Dec 14)">Week 50 (Dec 08 - Dec 14)</option>
            <option value="Week 51 (Dec 15 - Dec 21)">Week 51 (Dec 15 - Dec 21)</option>
            <option value="Week 52 (Dec 22 - Dec 28)">Week 52 (Dec 22 - Dec 28)</option>
            <option value="Week 53 (Dec 29 - Dec 31)">Week 53 (Dec 29 - Dec 31)</option>
          </select>
        </div>

        <div>
          <label>Zone:</label>
          <select name="zone" required>
            <option value="">Select Zone</option>
            <option>Zone 1</option>
            <option>Zone 2</option>
            <option>Zone 3</option>
          </select>
        </div>

        <div>
          <label>District:</label>
          <select name="district" required>
            <option value="">Select District</option>
            <option>Balangir</option>
            <option>Bargarh</option>
            <option>Cuttack</option>
            <option>Ganjam</option>
            <option>Kendujhar</option>
            <option>Koraput</option>
            <option>Mayurbhanj</option>
            <option>Sambalpur</option>
            <option>Sundargarh</option>
          </select>
        </div>

        <div class="full-width">
          <label>Upload Media (Photos/Videos):</label>
          <input type="file" name="mediaFile" accept="image/*,video/*" required>
        </div>
      </div>
      <button type="submit">Upload Media</button>
    </form>
    <h3>Uploaded Media Gallery</h3>
    <div id="media-gallery" style="margin-top: 40px;">
    </div>
  </div>

  <div id="presentations-section" style="display:none;">
    <h2>Project Presentations</h2>
    <div class="presentation-upload-form-container">
      <h3>Add New Presentation</h3>
      <form id="presentation-upload-form">
        <div>
          <label for="presentationWeekInfo">Week Number:</label>
          <select name="weekInfo" id="presentationWeekInfo" required>
            <option value="">Select Week</option>
            <option value="Week 19 (May 05 - May 11)">Week 19 (May 05 - May 11)</option>
            <option value="Week 20 (May 12 - May 18)">Week 20 (May 12 - May 18)</option>
            <option value="Week 21 (May 19 - May 25)">Week 21 (May 19 - May 25)</option>
            <option value="Week 22 (May 26 - Jun 01)">Week 22 (May 26 - Jun 01)</option>
            <option value="Week 23 (Jun 02 - Jun 08)">Week 23 (Jun 02 - Jun 08)</option>
            <option value="Week 24 (Jun 09 - Jun 15)">Week 24 (Jun 09 - Jun 15)</option>
            <option value="Week 25 (Jun 16 - Jun 22)">Week 25 (Jun 16 - Jun 22)</option>
            <option value="Week 26 (Jun 23 - Jun 29)">Week 26 (Jun 23 - Jun 29)</option>
            <option value="Week 27 (Jun 30 - Jul 06)">Week 27 (Jun 30 - Jul 06)</option>
            <option value="Week 28 (Jul 07 - Jul 13)">Week 28 (Jul 07 - Jul 13)</option>
            <option value="Week 29 (Jul 14 - Jul 20)">Week 29 (Jul 14 - Jul 20)</option>
            <option value="Week 30 (Jul 21 - Jul 27)">Week 30 (Jul 21 - Jul 27)</option>
            <option value="Week 31 (Jul 28 - Aug 03)">Week 31 (Jul 28 - Aug 03)</option>
            <option value="Week 32 (Aug 04 - Aug 10)">Week 32 (Aug 04 - Aug 10)</option>
            <option value="Week 33 (Aug 11 - Aug 17)">Week 33 (Aug 11 - Aug 17)</option>
            <option value="Week 34 (Aug 18 - Aug 24)">Week 34 (Aug 18 - Aug 24)</option>
            <option value="Week 35 (Aug 25 - Aug 31)">Week 35 (Aug 25 - Aug 31)</option>
            <option value="Week 36 (Sep 01 - Sep 07)">Week 36 (Sep 01 - Sep 07)</option>
            <option value="Week 37 (Sep 08 - Sep 14)">Week 37 (Sep 08 - Sep 14)</option>
            <option value="Week 38 (Sep 15 - Sep 21)">Week 38 (Sep 15 - Sep 21)</option>
            <option value="Week 39 (Sep 22 - Sep 28)">Week 39 (Sep 22 - Sep 28)</option>
            <option value="Week 40 (Sep 29 - Oct 05)">Week 40 (Sep 29 - Oct 05)</option>
            <option value="Week 41 (Oct 06 - Oct 12)">Week 41 (Oct 06 - Oct 12)</option>
            <option value="Week 42 (Oct 13 - Oct 19)">Week 42 (Oct 13 - Oct 19)</option>
            <option value="Week 43 (Oct 20 - Oct 26)">Week 43 (Oct 20 - Oct 26)</option>
            <option value="Week 44 (Oct 27 - Nov 02)">Week 44 (Oct 27 - Nov 02)</option>
            <option value="Week 45 (Nov 03 - Nov 09)">Week 45 (Nov 03 - Nov 09)</option>
            <option value="Week 46 (Nov 10 - Nov 16)">Week 46 (Nov 10 - Nov 16)</option>
            <option value="Week 47 (Nov 17 - Nov 23)">Week 47 (Nov 17 - Nov 23)</option>
            <option value="Week 48 (Nov 24 - Nov 30)">Week 48 (Nov 24 - Nov 30)</option>
            <option value="Week 49 (Dec 01 - Dec 07)">Week 49 (Dec 01 - Dec 07)</option>
            <option value="Week 50 (Dec 08 - Dec 14)">Week 50 (Dec 08 - Dec 14)</option>
            <option value="Week 51 (Dec 15 - Dec 21)">Week 51 (Dec 15 - Dec 21)</option>
            <option value="Week 52 (Dec 22 - Dec 28)">Week 52 (Dec 22 - Dec 28)</option>
            <option value="Week 53 (Dec 29 - Dec 31)">Week 53 (Dec 29 - Dec 31)</option>
          </select>
        </div>
        <div>
          <label for="presentationTitle">Presentation Title (Optional):</label>
          <input type="text" name="presentationTitle" id="presentationTitle">
        </div>
        <div>
          <label for="presentationIframeCode">Google Slides Embed Code (iframe):</label>
          <textarea name="iframeCode" id="presentationIframeCode" required
            placeholder="Paste the full <iframe> code from Google Slides here..."></textarea>
        </div>
        <button type="submit">Save Presentation</button>
      </form>
    </div>
    <div id="presentations-display-area" style="margin-top: 30px;">
    </div>
  </div>

  <div id="dummy4-section" style="display:none; text-align:center;">
    <h2>Dummy Section 4 Content</h2>
  </div>

  <script>
    var scriptURL = 'https://script.google.com/macros/s/AKfycbyoLTLQaMjJXBnN3luRiscIiOM1fnYEcpfUY3yLmWAICTGhkU8DOukytwfB-yh8sJUMwQ/exec';

    function fetchPresentations() {
      const presentationsContainer = document.getElementById('presentations-display-area');
      if (!presentationsContainer) {
        console.error("Presentations display area not found!");
        return;
      }
      presentationsContainer.innerHTML = '<p style="text-align:center;">Loading presentations...</p>';

      fetch(scriptURL + '?action=get_presentations')
        .then(res => {
          if (!res.ok) {
            return res.text().then(text => { throw new Error(`Failed to fetch presentations: ${res.status} ${text || res.statusText}`) });
          }
          return res.json();
        })
        .then(data => {
          console.log("Fetched presentations data:", data);
          if (data && data.error) {
            presentationsContainer.innerHTML = `<p class="error-message">Error loading presentations: ${data.error}</p>`;
            return;
          }
          if (!Array.isArray(data) || data.length === 0) {
            presentationsContainer.innerHTML = '<p style="text-align:center; margin-top:20px;">No presentations available at the moment. (Data array empty)</p>';
            return;
          }

          const [headers, ...rows] = data;
          if (!Array.isArray(headers) || headers.length === 0) {
            presentationsContainer.innerHTML = '<p style="text-align:center; margin-top:20px;">No presentation data or headers found.</p>';
            return;
          }

          const uniqueIdIndex = headers.indexOf('UniqueID');
          const weekIndex = headers.indexOf('Week');
          const titleIndex = headers.indexOf('Title');
          const iframeCodeIndex = headers.indexOf('IframeCode');

          if ([uniqueIdIndex, weekIndex, titleIndex, iframeCodeIndex].some(idx => idx === -1)) {
            console.error("Presentation data headers are missing or incorrect:", headers);
            presentationsContainer.innerHTML = '<p class="error-message">Error: Presentation data is not in the expected format (missing headers).</p>';
            return;
          }

          if (rows.length === 0) {
            presentationsContainer.innerHTML = '<p style="text-align:center; margin-top:20px;">No presentations have been added yet.</p>';
            return;
          }

          const presentations = rows.map(row => ({
            uniqueID: row[uniqueIdIndex],
            week: row[weekIndex],
            title: row[titleIndex],
            iframeCode: row[iframeCodeIndex]
          }));

          let html = '';
          if (presentations.length > 0) {
            const groupedByWeek = presentations.reduce((acc, pres) => {
              if (!acc[pres.week]) {
                acc[pres.week] = [];
              }
              acc[pres.week].push(pres);
              return acc;
            }, {});

            Object.keys(groupedByWeek).sort((a, b) => {
              const weekANumMatch = a.match(/\d+/);
              const weekBNumMatch = b.match(/\d+/);
              const weekANum = weekANumMatch ? parseInt(weekANumMatch[0]) : 0;
              const weekBNum = weekBNumMatch ? parseInt(weekBNumMatch[0]) : 0;
              return weekANum - weekBNum;
            }).forEach(week => {
              html += `<div class="presentation-week-group"><h3>${week}</h3>`;
              groupedByWeek[week].forEach(presentation => {
                const responsiveIframeCode = presentation.iframeCode
                  .replace(/width="[^"]*"/ig, '')
                  .replace(/height="[^"]*"/ig, '');
                html += `
                                <div class="presentation-item">
                                    ${presentation.title ? `<h4>${presentation.title}</h4>` : ''}
                                    <div class="presentation-container">
                                        ${responsiveIframeCode}
                                    </div>
                                    <button class="delete-button" onclick="deletePresentation('${presentation.uniqueID}')">Delete Presentation</button>
                                </div>
                            `;
              });
              html += `</div>`;
            });
          } else {
            html += '<p style="text-align:center; margin-top:20px;">No presentations available at the moment.</p>';
          }
          presentationsContainer.innerHTML = html;
        })
        .catch(error => {
          console.error('Error fetching presentations:', error);
          presentationsContainer.innerHTML = `<p class="error-message">Error loading presentations: ${error.message}</p>`;
        });
    }


    function renderTable(data, tableId, sectionType) {
      const tbody = document.querySelector(`#${tableId} tbody`);
      const thead = document.querySelector(`#${tableId} thead`);

      if (thead) thead.innerHTML = ""; else console.error(`Thead not found for ${tableId}`);
      if (tbody) tbody.innerHTML = ""; else console.error(`Tbody not found for ${tableId}`);

      if (!thead || !tbody) {
        alert(`Table structure incomplete for ${sectionType}. Cannot render.`);
        return;
      }

      if (!data || !Array.isArray(data) || (Array.isArray(data) && data.length > 0 && data[0] && data[0].error)) {
        let errorMessage = `No data or invalid data format received for ${sectionType}.`;
        if (Array.isArray(data) && data.length > 0 && data[0] && data[0].error) {
          errorMessage = `Error from server for ${sectionType}: ${data[0].error}`;
          if (data[0].sheet) errorMessage += ` (Sheet: ${data[0].sheet})`;
        } else if (data && data.error) {
          errorMessage = `Error from server for ${sectionType}: ${data.error}`;
        }
        console.warn(`Problematic data for ${tableId}:`, data);
        thead.innerHTML = `<tr><th>Notice</th></tr>`;
        tbody.innerHTML = `<tr><td class="error-message">${errorMessage}</td></tr>`;
        return;
      }

      if (data.length === 0) {
        console.warn(`Empty data array received for ${tableId}`);
        thead.innerHTML = `<tr><th>Notice</th></tr>`;
        tbody.innerHTML = `<tr><td class="error-message">No data available for ${sectionType}. The sheet might be empty or headers are missing.</td></tr>`;
        return;
      }

      let [headers, ...dataRows] = data;
      let photoUrlColIndex = -1;

      if (sectionType === 'meetings') {
        photoUrlColIndex = headers.indexOf('Photo URL');
        if (photoUrlColIndex !== -1) {
          headers = headers.filter((header, index) => index !== photoUrlColIndex);
        }
      }


      if (!headers || !Array.isArray(headers) || headers.length === 0) {
        console.warn(`No headers or invalid headers format for ${tableId}:`, headers);
        thead.innerHTML = `<tr><th>Error</th></tr>`;
        tbody.innerHTML = `<tr><td class="error-message">No headers or invalid header format received for ${sectionType}. Cannot display table.</td></tr>`;
        return;
      }

      thead.innerHTML = "<tr>" + headers.map(h => `<th>${h === undefined || h === null ? "" : h}</th>`).join('') + "<th>Actions</th></tr>";

      if (dataRows.length === 0) {
        tbody.innerHTML = "<tr><td colspan='" + (headers.length + 1) + "'>No entries found.</td></tr>";
        return;
      }

      let rowsWithIndex = dataRows.map((row, idx) => ({
        row,
        sheetRow: idx + 2
      }));

      try {
        if (sectionType === 'weeklyStatus' && data[0].indexOf('Week') !== -1 && data[0].indexOf('Zone') !== -1) {
          rowsWithIndex.sort((a, b) => {
            const weekIndex = data[0].indexOf('Week');
            const zoneIndex = data[0].indexOf('Zone');

            const valA = a.row && typeof a.row[weekIndex] === 'string' ? String(a.row[weekIndex]).match(/\d+/) : null;
            const weekA = valA ? parseInt(valA[0], 10) : 0;
            const valB = b.row && typeof b.row[weekIndex] === 'string' ? String(b.row[weekIndex]).match(/\d+/) : null;
            const weekB = valB ? parseInt(valB[0], 10) : 0;

            if (weekA !== weekB) return weekA - weekB;

            const zoneA = a.row && typeof a.row[zoneIndex] === 'string' ? a.row[zoneIndex] : "";
            const zoneB = b.row && typeof b.row[zoneIndex] === 'string' ? b.row[zoneIndex] : "";
            return zoneA.localeCompare(zoneB);
          });
        }

        if (sectionType === 'meetings') {
          const dateColumnIndexOriginal = data[0].indexOf('Meeting Date');
          if (dateColumnIndexOriginal !== -1) {
            rowsWithIndex.sort((a, b) => {
              const parseDate = (value) => {
                if (value === undefined || value === null || String(value).trim() === "") return new Date(NaN);
                if (value instanceof Date && !isNaN(value)) return value;
                if (typeof value === 'number') return new Date(Math.round((value - 25569) * 86400 * 1000));
                if (typeof value === 'string') {
                  if (/^\d{4}-\d{2}-\d{2}T/.test(value)) return new Date(value);
                  if (/^\d{4}-\d{2}-\d{2}$/.test(value)) return new Date(value + "T00:00:00");
                  if (/^\d{2}-\d{2}-\d{4}$/.test(value)) {
                    const [day, month, year] = value.split("-");
                    return new Date(`${year}-${month}-${day}T00:00:00`);
                  }
                }
                return new Date(value);
              };

              const valA = a.row && a.row.length > dateColumnIndexOriginal ? a.row[dateColumnIndexOriginal] : undefined;
              const valB = b.row && b.row.length > dateColumnIndexOriginal ? b.row[dateColumnIndexOriginal] : undefined;

              const dateA = parseDate(valA);
              const dateB = parseDate(valB);

              if (isNaN(dateA.getTime()) && isNaN(dateB.getTime())) return 0;
              if (isNaN(dateA.getTime())) return 1;
              if (isNaN(dateB.getTime())) return -1;
              return dateA - dateB;
            });
          } else {
            console.warn(`'Meeting Date' column not found for sorting in ${tableId}. Table will not be sorted by date.`);
          }
        }
      } catch (e) {
        console.error(`Error during sorting for ${tableId}:`, e);
        tbody.innerHTML = `<tr><td colspan="${headers.length + 1}" class="error-message">Error during data sorting. Entries may not be displayed correctly.</td></tr>`;
      }

      tbody.innerHTML = rowsWithIndex.map(({ row, sheetRow }) => {
        const rowIndex = sheetRow;
        if (!Array.isArray(row)) {
          console.error("Encountered a non-array row object:", row, "at original sheet row (approx):", sheetRow);
          return `<tr><td colspan="${headers.length + 1}" class="error-message">Error: Corrupted row data.</td></tr>`;
        }
        const rowData = encodeURIComponent(JSON.stringify(row));

        const cells = row.map((c, j) => {
          if (sectionType === 'meetings' && j === photoUrlColIndex) {
            return '';
          }

          let cellValue = (c === null || c === undefined) ? "" : String(c);
          const currentHeader = data[0][j];

          if ((currentHeader === 'Meeting Date' || currentHeader === 'Deadline')) {
            if (c instanceof Date && !isNaN(c)) {
              const day = String(c.getDate()).padStart(2, '0');
              const month = String(c.getMonth() + 1).padStart(2, '0');
              const year = c.getFullYear();
              cellValue = `${day}-${month}-${year}`;
            } else if (typeof c === "string" && /^\d{4}-\d{2}-\d{2}T/.test(c)) {
              const dateObj = new Date(c);
              if (!isNaN(dateObj.getTime())) {
                const day = String(dateObj.getDate()).padStart(2, '0');
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const year = dateObj.getFullYear();
                cellValue = `${day}-${month}-${year}`;
              }
            }
          }

          if (typeof c === "string" && c.includes('\n')) {
            const lines = c.split(/\r?\n/).filter(line => line.trim() !== '');
            const listItems = lines.map(item => {
              const cleanItem = item.trim().replace(/^\d+\.\s*/, '');
              return `<li>${cleanItem}</li>`;
            }).join('');
            return `<td><ol style="padding-left: 18px; margin: 0;">${listItems}</ol></td>`;
          }
          return `<td>${cellValue}</td>`;
        }).filter(cellHTML => cellHTML !== '').join('');

        const editFunc = sectionType === 'meetings' ? 'editMeeting' :
          sectionType === 'weeklyStatus' ? 'editStatus' : 'editAction';
        const deleteFunc = sectionType === 'meetings' ? 'deleteMeeting' :
          sectionType === 'weeklyStatus' ? 'deleteStatus' : 'deleteAction';

        return `<tr>${cells}<td>
            <button onclick="${editFunc}(${rowIndex}, this)">Edit</button>
            <button onclick="${deleteFunc}(${rowIndex})">Delete</button>
            <input type="hidden" value="${rowData}">
            </td></tr>`;
      }).join('');
    }

    function fetchData() {
      const commonCatchHandler = (error, tableId, sectionName) => {
        console.error(`Error fetching or processing ${sectionName} data:`, error);
        const tableBody = document.querySelector(`#${tableId} tbody`);
        const tableHead = document.querySelector(`#${tableId} thead`);
        let colspan = 5;
        if (tableHead) {
          if (tableHead.rows.length > 0 && tableHead.rows[0].cells.length > 0) {
            colspan = tableHead.rows[0].cells.length;
          } else {
            tableHead.innerHTML = `<tr><th>Error</th></tr>`;
            colspan = 1;
          }
        }
        if (tableBody) {
          tableBody.innerHTML = `<tr><td colspan="${colspan}" class="error-message">Failed to load ${sectionName} entries. ${error.message}. See console for more details.</td></tr>`;
        }
      };

      fetch(scriptURL + '?sheet=Meetings')
        .then(res => {
          if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! Status: ${res.status} for Meetings. Server says: ${text || res.statusText}`) });
          return res.json();
        })
        .then(data => {
          console.log('Meetings data received:', data);
          if (data && data.error) {
            commonCatchHandler(new Error(data.error + (data.sheet ? ` (Sheet: ${data.sheet})` : "")), 'meeting-table', 'Meetings');
          } else {
            renderTable(data, 'meeting-table', 'meetings');
          }
        })
        .catch(error => commonCatchHandler(error, 'meeting-table', 'Meetings'));

      fetch(scriptURL + '?sheet=Action Items')
        .then(res => {
          if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! Status: ${res.status} for Action Items. Server says: ${text || res.statusText}`) });
          return res.json();
        })
        .then(data => {
          console.log('Action Items data received:', data);
          if (data && data.error) {
            commonCatchHandler(new Error(data.error + (data.sheet ? ` (Sheet: ${data.sheet})` : "")), 'action-table', 'Action Items');
          } else {
            renderTable(data, 'action-table', 'actions');
          }
        })
        .catch(error => commonCatchHandler(error, 'action-table', 'Action Items'));

      fetch(scriptURL + '?sheet=Weekly Status')
        .then(res => {
          if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! Status: ${res.status} for Weekly Status. Server says: ${text || res.statusText}`) });
          return res.json();
        })
        .then(data => {
          console.log('Weekly Status data received:', data);
          if (data && data.error) {
            commonCatchHandler(new Error(data.error + (data.sheet ? ` (Sheet: ${data.sheet})` : "")), 'weekly-status-table', 'Weekly Status');
          } else {
            renderTable(data, 'weekly-status-table', 'weeklyStatus');
          }
        })
        .catch(error => commonCatchHandler(error, 'weekly-status-table', 'Weekly Status'));
    }

    function fetchWeeklyStatus() {
      fetch(scriptURL + "?sheet=Weekly Status")
        .then(res => {
          if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! Status: ${res.status} for Weekly Status (refresh). Server says: ${text || res.statusText}`) });
          return res.json();
        })
        .then(data => {
          console.log('Weekly Status data (re-fetched):', data);
          if (data && data.error) {
            console.error('Error refreshing Weekly Status:', data.error);
            const tbody = document.querySelector('#weekly-status-table tbody');
            if (tbody) tbody.innerHTML = `<tr><td colspan="5" class="error-message">Failed to refresh. ${data.error}</td></tr>`;
          } else {
            renderTable(data, 'weekly-status-table', 'weeklyStatus');
          }
        })
        .catch(error => {
          console.error('Error in fetchWeeklyStatus function:', error);
          const tbody = document.querySelector('#weekly-status-table tbody');
          if (tbody) tbody.innerHTML = `<tr><td colspan="5" class="error-message">Failed to refresh. ${error.message}</td></tr>`;
        });
    }

    function showSection(sectionIdToShow) {
      const allSectionDivIds = ['meetings-section', 'weeklyStatus-section', 'media-section', 'presentations-section', 'dummy4-section'];
      allSectionDivIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.display = (id === sectionIdToShow) ? 'block' : 'none';
        }
      });
      if (sectionIdToShow === 'media-section') {
        fetchMediaGallery();
      }
      if (sectionIdToShow === 'presentations-section') {
        fetchPresentations();
      }
    }

    function getFormDataByIndex(keys, dataArray) {
      const formData = {};
      if (!Array.isArray(dataArray)) {
        console.warn("getFormDataByIndex received non-array data:", dataArray);
        keys.forEach(key => formData[key] = "");
        return formData;
      }
      keys.forEach((key, index) => {
        formData[key] = dataArray[index] !== undefined ? dataArray[index] : "";
      });
      return formData;
    }

    function formatDateForInput(dateStringOrObject) {
      if (!dateStringOrObject) return "";
      let dateObj;
      if (dateStringOrObject instanceof Date && !isNaN(dateStringOrObject)) {
        dateObj = dateStringOrObject;
      } else if (typeof dateStringOrObject === 'string') {
        if (dateStringOrObject.includes('T')) {
          dateObj = new Date(dateStringOrObject.split('T')[0]);
        } else if (dateStringOrObject.match(/^\d{2}-\d{2}-\d{4}$/)) {
          const parts = dateStringOrObject.split('-');
          dateObj = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
        } else if (dateStringOrObject.match(/^\d{4}-\d{2}-\d{2}$/)) {
          dateObj = new Date(dateStringOrObject);
        } else {
          dateObj = new Date(dateStringOrObject);
        }
      } else if (typeof dateStringOrObject === 'number') {
        dateObj = new Date(Math.round((dateStringOrObject - 25569) * 86400 * 1000));
      } else {
        return "";
      }

      if (isNaN(dateObj.getTime())) return "";

      const tempDate = new Date(dateObj.getUTCFullYear(), dateObj.getUTCMonth(), dateObj.getUTCDate());
      return tempDate.toISOString().split('T')[0];
    }

    function editMeeting(row, btn) {
      const rawDataArray = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input[type="hidden"]').value));
      const form = document.forms['meeting-form'];
      form.reset();
      form.row.value = row;

      const fieldKeys = ['meetingId', 'meetingDate', 'zone', 'district', 'coldRoom', 'meetingTitle', 'conductedBy', 'attendees', 'meetingAgenda', 'meetingDiscussion'];
      const dataToPopulate = getFormDataByIndex(fieldKeys, rawDataArray);

      form.meetingId.value = dataToPopulate.meetingId;
      form.meetingDate.value = formatDateForInput(dataToPopulate.meetingDate);
      form.zone.value = dataToPopulate.zone;
      form.district.value = dataToPopulate.district;
      form.coldRoom.value = dataToPopulate.coldRoom;
      form.meetingTitle.value = dataToPopulate.meetingTitle;
      form.conductedBy.value = dataToPopulate.conductedBy;
      form.attendees.value = dataToPopulate.attendees;
      form.meetingAgenda.value = dataToPopulate.meetingAgenda;
      form.meetingDiscussion.value = dataToPopulate.meetingDiscussion;

      document.getElementById('meeting-mode').innerText = "Mode: Editing Meeting (Row " + row + ")";
      showSection('meetings-section');
    }

    function editStatus(row, btn) {
      const rawDataArray = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input[type="hidden"]').value));
      const form = document.forms['weekly-status-form'];
      form.reset();
      form.row.value = row;

      const fieldKeys = ['weekInfo', 'zone', 'district', 'currentWeekUpdate', 'nextWeekUpdate'];
      const dataToPopulate = getFormDataByIndex(fieldKeys, rawDataArray);

      form.weekInfo.value = dataToPopulate.weekInfo;
      form.zone.value = dataToPopulate.zone;
      form.district.value = dataToPopulate.district;
      form.currentWeekUpdate.value = dataToPopulate.currentWeekUpdate;
      form.nextWeekUpdate.value = dataToPopulate.nextWeekUpdate;

      document.getElementById('status-mode').innerText = "Mode: Editing Status (Row " + row + ")";
      showSection('weeklyStatus-section');
    }

    function editAction(row, btn) {
      const rawDataArray = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input[type="hidden"]').value));
      const form = document.forms['action-form'];
      form.reset();
      form.row.value = row;

      const fieldKeys = ['meetingId', 'actionItem', 'assignedTo', 'deadline', 'status'];
      const dataToPopulate = getFormDataByIndex(fieldKeys, rawDataArray);

      form.meetingId.value = dataToPopulate.meetingId;
      form.actionItem.value = dataToPopulate.actionItem;
      form.assignedTo.value = dataToPopulate.assignedTo;
      form.deadline.value = formatDateForInput(dataToPopulate.deadline);
      form.status.value = dataToPopulate.status;

      document.getElementById('action-mode').innerText = "Mode: Editing Action Item (Row " + row + ")";
      showSection('meetings-section');
    }

    function postData(formDataObject, callback) {
      const formData = new FormData();
      for (const key in formDataObject) {
        formData.append(key, formDataObject[key]);
      }

      fetch(scriptURL, { method: 'POST', body: formData })
        .then(res => {
          if (!res.ok) {
            return res.text().then(text => {
              let errorMsg = `Server error: ${res.status} - ${res.statusText || 'Unknown error'}`;
              try {
                const errObj = JSON.parse(text);
                errorMsg = errObj.error || errObj.message || errorMsg;
              } catch (e) { /* Ignore if text is not JSON, use default */ }
              throw new Error(errorMsg);
            });
          }
          return res.json();
        })
        .then(response => {
          if (response.error) {
            throw new Error(response.error);
          }
          let successMessage = response.message || 'Operation successful.';
          if (response.meetingId) {
            successMessage += ' Meeting ID: ' + response.meetingId;
            if (document.getElementById('meetingId')) document.getElementById('meetingId').value = response.meetingId;
            if (document.getElementById('action-meetingId')) document.getElementById('action-meetingId').value = response.meetingId;
          }
          alert(successMessage);
          if (callback) callback();
        })
        .catch(err => {
          console.error('Error posting data:', err);
          alert('Error: ' + err.message);
        });
    }

    function deleteMeeting(row) {
      if (confirm("Delete this meeting?")) postData({ action: "delete_meeting", row: row }, fetchData);
    }
    function deleteAction(row) {
      if (confirm("Delete this action item?")) postData({ action: "delete_action", row: row }, fetchData);
    }
    function deleteStatus(row) {
      if (confirm("Delete this status entry?")) postData({ action: "delete_status", row: row }, fetchWeeklyStatus);
    }

    document.getElementById('meeting-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const isEdit = form.row.value && form.row.value.trim() !== "";

      formData.set("action", isEdit ? "edit_meeting" : "add_meeting");
      if (isEdit) formData.set("row", form.row.value);

      formData.delete('photoUrlFile');
      formData.delete('photoUrlText');

      const formObject = Object.fromEntries(formData.entries());

      postData(formObject, () => {
        fetchData();
        form.reset();
        document.getElementById('meeting-mode').innerText = 'Mode: Add New Meeting';
      });
    });

    document.getElementById('action-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const formObject = Object.fromEntries(formData.entries());
      const isEdit = form.row.value && form.row.value.trim() !== '';
      formObject.action = isEdit ? 'edit_action' : 'add_action';
      if (isEdit) formObject.row = form.row.value;
      postData(formObject, () => {
        fetchData();
        form.reset();
        document.getElementById('action-mode').innerText = 'Mode: Add New Action Item';
      });
    });

    document.getElementById('weekly-status-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const formObject = Object.fromEntries(formData.entries());
      const isEdit = form.row.value && form.row.value.trim() !== "";
      formObject.action = isEdit ? "edit_status" : "add_status";
      if (isEdit) formObject.row = form.row.value;
      postData(formObject, () => {
        fetchWeeklyStatus();
        form.reset();
        document.getElementById('status-mode').innerText = 'Mode: Add New Status';
      });
    });

    document.getElementById('media-upload-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = e.target;
      const fileInput = form.querySelector('input[name="mediaFile"]');
      const file = fileInput.files[0];
      const submitButton = form.querySelector('button[type="submit"]');

      if (!file) {
        alert("Please select a file.");
        return;
      }

      submitButton.disabled = true;
      submitButton.textContent = 'Uploading...';

      const reader = new FileReader();
      reader.onload = function (event) {
        const base64DataWithPrefix = event.target.result;
        const MimeTypeMatch = base64DataWithPrefix.match(/^data:(.+);base64,/);
        if (!MimeTypeMatch || MimeTypeMatch.length < 2) {
          alert("Could not determine file type for Base64 upload.");
          submitButton.disabled = false;
          submitButton.textContent = 'Upload Media';
          return;
        }
        const mimeType = MimeTypeMatch[1];
        const base64Data = base64DataWithPrefix.substring(base64DataWithPrefix.indexOf(',') + 1);
        const fileName = file.name;

        const formDataForMediaBase64 = new FormData();
        formDataForMediaBase64.append('action', 'upload_media_base64');
        formDataForMediaBase64.append('weekInfo', form.weekInfo.value);
        formDataForMediaBase64.append('zone', form.zone.value);
        formDataForMediaBase64.append('district', form.district.value);
        formDataForMediaBase64.append('dataBase64', base64Data);
        formDataForMediaBase64.append('fileName', fileName);
        formDataForMediaBase64.append('mimeType', mimeType);

        fetch(scriptURL, { method: 'POST', body: formDataForMediaBase64 })
          .then(res => {
            if (!res.ok) {
              return res.json().then(err => {
                throw new Error(err.error || err.message || `Media Upload HTTP error! Status: ${res.status}`);
              }).catch(() => {
                throw new Error(`Media Upload HTTP error! Status: ${res.status}. Check server logs for details.`);
              });
            }
            return res.json();
          })
          .then(response => {
            if (response.error) throw new Error(response.error);
            alert(response.message || 'Upload successful!');
            form.reset();
            fetchMediaGallery();
          })
          .catch(err => {
            console.error('Upload failed:', err);
            alert('Upload failed: ' + err.message);
          })
          .finally(() => {
            submitButton.disabled = false;
            submitButton.textContent = 'Upload Media';
          });
      };
      reader.onerror = function (error) {
        console.error("File reading error for Base64:", error);
        alert("Error reading file for upload.");
        submitButton.disabled = false;
        submitButton.textContent = 'Upload Media';
      };
      reader.readAsDataURL(file);
    });

    // Listener for the new presentation form
    document.getElementById('presentation-upload-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const formObject = Object.fromEntries(formData.entries());
      formObject.action = 'add_presentation';

      const submitButton = form.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      submitButton.textContent = 'Saving...';

      postData(formObject, () => {
        form.reset();
        fetchPresentations(); // Refresh the list of presentations
        submitButton.disabled = false;
        submitButton.textContent = 'Save Presentation';
      });
    });

    function deletePresentation(uniqueID) {
      if (!uniqueID) {
        alert("Error: Presentation ID is missing. Cannot delete.");
        return;
      }
      if (confirm("Are you sure you want to delete this presentation?")) {
        const deleteButtons = document.querySelectorAll('.delete-button'); // Disable all to prevent multiple clicks
        deleteButtons.forEach(btn => btn.disabled = true);


        postData({ action: "delete_presentation", uniqueID: uniqueID }, () => {
          fetchPresentations();
          // Buttons will be re-enabled when fetchPresentations re-renders the content, 
          // or if not, they would need to be re-enabled here or in a finally block.
          // For simplicity, fetchPresentations will re-render them without disabled attribute.
        });
      }
    }


    function fetchMediaGallery() {
      fetch(scriptURL + '?sheet=Media')
        .then(res => {
          if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! status: ${res.status} for Media Gallery. Server says: ${text || res.statusText}`) });
          return res.json();
        })
        .then(data => {
          const gallery = document.getElementById("media-gallery");
          if (!gallery) return;

          if (data && data.error) {
            gallery.innerHTML = `<p class="error-message">Error loading media: ${data.error}</p>`;
            return;
          }
          if (!Array.isArray(data) || data.length < 1) {
            gallery.innerHTML = "<p>No media data found or data in unexpected format.</p>";
            return;
          }

          const [headers, ...rows] = data;
          if (!Array.isArray(headers) || headers.length === 0) {
            gallery.innerHTML = "<p>Media headers missing.</p>";
            return;
          }

          if (rows.length === 0) {
            gallery.innerHTML = "<p>No media found in the gallery.</p>";
            return;
          }

          const weekIndex = headers.indexOf('Week');
          const zoneIndex = headers.indexOf('Zone');
          const districtIndex = headers.indexOf('District');
          const fileNameIndex = headers.indexOf('File Name');
          const urlIndex = headers.indexOf('File URL');
          const typeIndex = headers.indexOf('File Type');

          if ([weekIndex, zoneIndex, districtIndex, fileNameIndex, urlIndex, typeIndex].some(idx => idx === -1)) {
            console.error("One or more required headers missing in Media sheet data:", headers);
            gallery.innerHTML = "<p class='error-message'>Error: Media data is not in the expected column format.</p>";
            return;
          }

          const grouped = {};
          rows.forEach(row => {
            if (!Array.isArray(row)) return;
            const week = row[weekIndex];
            const zone = row[zoneIndex];
            const district = row[districtIndex];
            const fileName = row[fileNameIndex];
            const url = row[urlIndex];
            const typeFromServer = row[typeIndex];
            const type = typeFromServer || (String(url).match(/\.(jpe?g|png|gif|webp)$/i) ? 'image' : String(url).match(/\.(mp4|mov|avi|webm)$/i) ? 'video' : 'file');

            if (!week || !zone || !district) return;

            if (!grouped[week]) grouped[week] = {};
            if (!grouped[week][zone]) grouped[week][zone] = {};
            if (!grouped[week][zone][district]) grouped[week][zone][district] = [];
            grouped[week][zone][district].push({ url, type, fileName: fileName || "Untitled" });
          });

          let html = "";
          Object.keys(grouped).sort().forEach(week => {
            html += `<div class="media-week-group"> 
                   <h3>${week}</h3>`;
            Object.keys(grouped[week]).sort().forEach(zone => {
              html += `<div style="margin: 15px 0;">
                     <h4>${zone}</h4>`;
              Object.keys(grouped[week][zone]).sort().forEach(district => {
                html += `<div style="margin: 10px 0;">
                       <h5>${district}</h5>`;
                html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">`;
                grouped[week][zone][district].forEach(media => {
                  const match = String(media.url).match(/\/d\/([a-zA-Z0-9_-]{25,})/);
                  const fileId = match ? match[1] : '';
                  const directLink = fileId ? `https://drive.google.com/uc?export=view&id=${fileId}` : media.url;
                  const thumbnailLink = fileId ? `https://drive.google.com/thumbnail?id=${fileId}&sz=w200-h200` : directLink;

                  if (String(media.type).startsWith('image')) {
                    html += `
                  <div style="position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <a href="${directLink}" target="_blank" title="${media.fileName || 'View image'}" style="display: block;">
                      <img src="${thumbnailLink}" 
                           style="width: 100%; height: 150px; object-fit: cover; transition: transform 0.2s; background-color: #f0f0f0;"
                           onmouseover="this.style.transform='scale(1.05)'" 
                           onmouseout="this.style.transform='scale(1)'"
                           onerror="this.onerror=null; this.src='https://via.placeholder.com/150?text=No+Preview';" 
                           alt="${media.fileName || 'Uploaded image'}">
                    </a>
                    <div style="font-size: 0.8em; text-align: center; padding: 5px; background: rgba(255,255,255,0.8); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${media.fileName}">${media.fileName}</div>
                  </div>`;
                  } else if (String(media.type).startsWith('video')) {
                    html += `
                  <div style="position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <video controls preload="metadata" style="width: 100%; height: 150px; object-fit: cover; background:#000;">
                      <source src="${directLink}" type="${media.type || 'video/mp4'}">
                      Your browser does not support the video tag. <a href="${directLink}" target="_blank">Download video</a>
                    </video>
                    <div style="font-size: 0.8em; text-align: center; padding: 5px; background: rgba(255,255,255,0.8); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${media.fileName}">${media.fileName}</div>
                  </div>`;
                  } else {
                    html += `
                  <div style="position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding:10px; background:#f0f0f0; height:150px; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <a href="${directLink}" target="_blank" title="Download ${media.fileName}" style="word-break:break-all; text-decoration:none; color:#333; text-align:center;">
                      <span style="font-size:2.5em; margin-bottom:10px; display:block;"></span>
                      <div style="font-size: 0.8em;">${media.fileName}</div>
                    </a>
                  </div>`;
                  }
                });
                html += `</div></div>`;
              });
              html += `</div>`;
            });
            html += `</div>`;
          });
          gallery.innerHTML = html || "<p>No media to display after grouping.</p>";
        })
        .catch(error => {
          console.error('Error fetching media gallery:', error);
          const gallery = document.getElementById("media-gallery");
          if (gallery) gallery.innerHTML = `<p class="error-message">Error loading media gallery: ${error.message}. Please try again later.</p>`;
        });
    }

    window.onload = function () {
      fetchData();
      // showSection('meetings-section'); 
    };
  </script>
</body>

</html>
