<!DOCTYPE html>
<html>

<head>
  <title>BCIEP India Meeting & Action Tracker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 1300px;
      background: #f9f9f9;
    }

    h2 {
      text-align: center;
      margin-top: 40px;
      background-color: #003366;
      color: #fff;
      padding: 10px;
      border-radius: 5px;
    }

    .form-container {
      display: flex;
      gap: 30px;
      justify-content: space-between;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      flex: 1;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    textarea {
      resize: vertical;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #003366;
      color: white;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background-color: #005299;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 13px;
    }

    th {
      background-color: #e0e0e0;
    }
  </style>
</head>

<body>
  <div style="text-align: center; margin-bottom: 20px;">
    <button onclick="showSection('meetings')" style="padding:10px 20px; margin:5px;">Meetings</button>
    <button onclick="showSection('weeklyStatus')" style="padding:10px 20px; margin:5px;">Weekly Status</button>
    <button onclick="showSection('dummy2')" style="padding:10px 20px; margin:5px;">Dummy 2</button>
    <button onclick="showSection('dummy3')" style="padding:10px 20px; margin:5px;">Dummy 3</button>
    <button onclick="showSection('dummy4')" style="padding:10px 20px; margin:5px;">Dummy 4</button>
  </div>
  <div id="meetings-section" style="display: none;">
    <h2>Bloomberg Cities Idea Exchange || India || Meeting & Action Tracker</h2>
    <div class="form-container">
      <form id="meeting-form" style="margin-top: 0; border: 2px solid #ccc;">
        <h3 style="margin-top: 0px;">Meeting Agenda and Discussions</h3>
        <div id="meeting-mode"
          style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5;"
          style="margin-bottom: 10px; font-weight: bold; color: #d9534f;">Mode: Add New Meeting</div>
        <input type="hidden" name="row">
        <div class="form-grid">
          <div><label>Meeting ID:</label><input type="text" name="meetingId" id="meetingId" readonly
              style="padding: 8px 0px;"></div>
          <div><label>Meeting Date:</label><input type="date" name="meetingDate" required style="padding: 7px 0px;">
          </div>
          <div><label>Zone:</label><select name="zone" required>
              <option value="">Select Zone</option>
              <option>Zone 1</option>
              <option>Zone 2</option>
              <option>Zone 3</option>
            </select></div>
          <div><label>District:</label><select name="district" required>
              <option value="">Select District</option>
              <option>Balangir</option>
              <option>Bargarh</option>
              <option>Cuttack</option>
              <option>Ganjam</option>
              <option>Kendujhar</option>
              <option>Koraput</option>
              <option>Mayurbhanj</option>
              <option>Sambalpur</option>
              <option>Sundargarh</option>
            </select></div>
          <div><label>Cold Room Location (Optional):</label><select name="coldRoom">
              <option value="">None</option>
              <option>Besil</option>
              <option>RMC Behera Market</option>
              <option>RMC Sarandapali</option>
              <option>Athagarh NAC</option>
              <option>Nistipur</option>
              <option>Dudhianali</option>
              <option>RMC Kalabada Market Yard</option>
              <option>RMC Digapahandi Market Yard</option>
              <option>RMC Bhanjanagar Market Yard</option>
              <option>Bahadapada</option>
              <option>RMC Buguda Market Yard</option>
              <option>Chatrapur Market</option>
              <option>Kolasingi</option>
              <option>Raisuan</option>
              <option>Madarangajodi</option>
              <option>Mukuna</option>
              <option>Tikarapada</option>
              <option>Nuagaon (Narsinghpur)</option>
              <option>Baradapala,</option>
              <option>Ratanpur</option>
              <option>Tulasichaura</option>
              <option>Kathakaranjia</option>
              <option>Ghatabhagra</option>
              <option>Malimarla</option>
              <option>Baghiatangar</option>
              <option>Chapaldihi</option>
              <option>Akhapolan</option>
              <option>Sandhenkia</option>
              <option>Tikhia</option>
              <option>Kuchinda</option>
              <option>Bhojpur</option>
              <option>T.Niktimal</option>
              <option>Charmal</option>
              <option>Khetrajpur</option>
              <option>Kardega</option>
              <option>Kadalidhipa</option>
              <option>Khariapada</option>
              <option>Bhelluadihi</option>
              <option>Domposh</option>
              <option>Rajpur</option>
              <option>Kansar</option>
            </select></div>
          <div><label>Upload Meeting Photo:</label><input type="file" name="photoUrl" accept="image/*"
              style="padding: 5px 0px;"></div>
          <div class="full-width"><label>Meeting Title:</label><input type="text" name="meetingTitle" required
              style="padding: 8px 0px;"></div>
          <div><label>Conducted By:</label><select name="conductedBy" required>
              <option>Akshaya Kumar Pallai</option>
              <option>Vicky Vikram Das</option>
              <option>Krushna Chandra Parida</option>
              <option>Mary Helena Kujur</option>
              <option>Hemanti Sabar</option>
              <option>Amlan Abhinav</option>
              <option>Asutosh Nayak</option>
              <option>Pratham Parida</option>
              <option>Rashmi Prava Nayak</option>
              <option>Minati Mallick</option>
              <option>Sunita Patra</option>
              <option>Deepak Kumar Tudu</option>
              <option>Swati Rani Achary</option>
            </select></div>
          <div><label>Attendees:</label><textarea name="attendees" required style="padding: 1px 0px;"></textarea></div>
          <div class="full-width"><label>Meeting Agenda:</label><textarea name="meetingAgenda" required
              style="padding: 8px 0px;"></textarea></div>
          <div class="full-width"><label>What points were discussed during the meeting?</label><textarea
              name="meetingDiscussion" style="padding: 8px 0px;"></textarea></div>
        </div>
        <button type="submit">Save Meeting</button>
      </form>

      <form id="action-form" style="margin-top: 0; border: 2px solid #ccc;">
        <h3 style="margin-top: 0px;">Meeting Action Items</h3>
        <div id="action-mode"
          style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5;"
          style="margin-bottom: 10px; font-weight: bold; color: #d9534f;">Mode: Add New Action Item
        </div>
        <input type="hidden" name="row">
        <div class="form-grid">
          <div><label>Meeting ID:</label><input type="text" name="meetingId" id="action-meetingId" readonly required
              style="padding: 8px 0px;">
          </div>
          <div class="full-width"><label>Action Item:</label><input type="text" name="actionItem" required
              style="padding: 8px 0px;"></div>
          <div><label>Assigned To:</label><select name="assignedTo" required>
              <option>Akshaya Kumar Pallai</option>
              <option>Vicky Vikram Das</option>
              <option>Krushna Chandra Parida</option>
              <option>Mary Helena Kujur</option>
              <option>Hemanti Sabar</option>
              <option>Amlan Abhinav</option>
              <option>Asutosh Nayak</option>
              <option>Pratham Parida</option>
              <option>Rashmi Prava Nayak</option>
              <option>Minati Mallick</option>
              <option>Sunita Patra</option>
              <option>Deepak Kumar Tudu</option>
              <option>Swati Rani Achary</option>
            </select></div>
          <div><label>Deadline:</label><input type="date" name="deadline" required style="padding: 8px 0px;"></div>
          <div class="full-width"><label>Status:</label><select name="status" required>
              <option value="">Select Status</option>
              <option>Pending</option>
              <option>In Progress</option>
              <option>Completed</option>
            </select></div>
        </div>
        <button type="submit">Add Action Item</button>
        <button type="reset">Clear</button>
      </form>
    </div>
    <h2 style="text-align: center; margin-top: 20px">All Meetings</h2>
    <table id="meeting-table">
      <thead></thead>
      <tbody></tbody>
    </table>

    <h2 style="text-align: center;">All Action Items</h2>
    <table id="action-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="weeklyStatus-section" style="display:none;">
    <h2 style="text-align:center; background:#0b2d64; color:white; padding:10px; border-radius:5px;">
      Bloomberg Cities Idea Exchange || India || Weekly Status
    </h2>

    <form id="weekly-status-form" style=margin:0 auto; background:white; padding:20px; border-radius:6px; border:2px
      solid #ccc;">
      <input type="hidden" name="row">
      <h3>Enter Weekly Status</h3>
      <div id="status-mode"
        style="margin: 10px 0; margin-bottom: 15px; padding: 5px; border: 2px solid #aaa; border-radius: 4px; background-color: #f5f5f5;"
        style="margin-bottom: 10px; font-weight: bold; color: #d9534f;">Mode: Add New Status</div>
      <label>Week Number:</label>
      <select name="weekInfo" required>
        <option value="">Select Week</option>
        <option value="Week 19 (May 05 - May 11)">Week 19 (May 05 - May 11)</option>
        <option value="Week 20 (May 12 - May 18)">Week 20 (May 12 - May 18)</option>
        <option value="Week 21 (May 19 - May 25)">Week 21 (May 19 - May 25)</option>
        <option value="Week 22 (May 26 - Jun 01)">Week 22 (May 26 - Jun 01)</option>
        <option value="Week 23 (Jun 02 - Jun 08)">Week 23 (Jun 02 - Jun 08)</option>
        <option value="Week 24 (Jun 09 - Jun 15)">Week 24 (Jun 09 - Jun 15)</option>
        <option value="Week 25 (Jun 16 - Jun 22)">Week 25 (Jun 16 - Jun 22)</option>
        <option value="Week 26 (Jun 23 - Jun 29)">Week 26 (Jun 23 - Jun 29)</option>
        <option value="Week 27 (Jun 30 - Jul 06)">Week 27 (Jun 30 - Jul 06)</option>
        <option value="Week 28 (Jul 07 - Jul 13)">Week 28 (Jul 07 - Jul 13)</option>
        <option value="Week 29 (Jul 14 - Jul 20)">Week 29 (Jul 14 - Jul 20)</option>
        <option value="Week 30 (Jul 21 - Jul 27)">Week 30 (Jul 21 - Jul 27)</option>
        <option value="Week 31 (Jul 28 - Aug 03)">Week 31 (Jul 28 - Aug 03)</option>
        <option value="Week 32 (Aug 04 - Aug 10)">Week 32 (Aug 04 - Aug 10)</option>
        <option value="Week 33 (Aug 11 - Aug 17)">Week 33 (Aug 11 - Aug 17)</option>
        <option value="Week 34 (Aug 18 - Aug 24)">Week 34 (Aug 18 - Aug 24)</option>
        <option value="Week 35 (Aug 25 - Aug 31)">Week 35 (Aug 25 - Aug 31)</option>
        <option value="Week 36 (Sep 01 - Sep 07)">Week 36 (Sep 01 - Sep 07)</option>
        <option value="Week 37 (Sep 08 - Sep 14)">Week 37 (Sep 08 - Sep 14)</option>
        <option value="Week 38 (Sep 15 - Sep 21)">Week 38 (Sep 15 - Sep 21)</option>
        <option value="Week 39 (Sep 22 - Sep 28)">Week 39 (Sep 22 - Sep 28)</option>
        <option value="Week 40 (Sep 29 - Oct 05)">Week 40 (Sep 29 - Oct 05)</option>
        <option value="Week 41 (Oct 06 - Oct 12)">Week 41 (Oct 06 - Oct 12)</option>
        <option value="Week 42 (Oct 13 - Oct 19)">Week 42 (Oct 13 - Oct 19)</option>
        <option value="Week 43 (Oct 20 - Oct 26)">Week 43 (Oct 20 - Oct 26)</option>
        <option value="Week 44 (Oct 27 - Nov 02)">Week 44 (Oct 27 - Nov 02)</option>
        <option value="Week 45 (Nov 03 - Nov 09)">Week 45 (Nov 03 - Nov 09)</option>
        <option value="Week 46 (Nov 10 - Nov 16)">Week 46 (Nov 10 - Nov 16)</option>
        <option value="Week 47 (Nov 17 - Nov 23)">Week 47 (Nov 17 - Nov 23)</option>
        <option value="Week 48 (Nov 24 - Nov 30)">Week 48 (Nov 24 - Nov 30)</option>
        <option value="Week 49 (Dec 01 - Dec 07)">Week 49 (Dec 01 - Dec 07)</option>
        <option value="Week 50 (Dec 08 - Dec 14)">Week 50 (Dec 08 - Dec 14)</option>
        <option value="Week 51 (Dec 15 - Dec 21)">Week 51 (Dec 15 - Dec 21)</option>
        <option value="Week 52 (Dec 22 - Dec 28)">Week 52 (Dec 22 - Dec 28)</option>
        <option value="Week 53 (Dec 29 - Dec 31)">Week 53 (Dec 29 - Dec 31)</option>
      </select>

      <label>Zone:</label>
      <select name="zone" required>
        <option value="">Select Zone</option>
        <option>Zone 1</option>
        <option>Zone 2</option>
        <option>Zone 3</option>
      </select>

      <label>District:</label>
      <select name="district" required>
        <option value="">Select District</option>
        <option>Balangir</option>
        <option>Bargarh</option>
        <option>Cuttack</option>
        <option>Ganjam</option>
        <option>Kendujhar</option>
        <option>Koraput</option>
        <option>Mayurbhanj</option>
        <option>Sambalpur</option>
        <option>Sundargarh</option>
      </select>

      <label>Summary of This Week Activities:</label>
      <textarea name="currentWeekUpdate" rows="3" required style="padding: 8px 0px;"></textarea>

      <label>Activities Planned for Next Week:</label>
      <textarea name="nextWeekUpdate" rows="4" required style="padding: 8px 0px;"></textarea>

      <button type="submit">Save Status</button>
    </form>
    <h2 style="text-align: center; margin-top: 20px">All Weekly Status</h2>
    <table id="weekly-status-table" style="margin:0 auto;">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="dummy2-section" style="display:none; text-align:center;">
    <h2>Dummy Section 2 Content</h2>
  </div>
  <div id="dummy3-section" style="display:none; text-align:center;">
    <h2>Dummy Section 3 Content</h2>
  </div>
  <div id="dummy4-section" style="display:none; text-align:center;">
    <h2>Dummy Section 4 Content</h2>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyoLTLQaMjJXBnN3luRiscIiOM1fnYEcpfUY3yLmWAICTGhkU8DOukytwfB-yh8sJUMwQ/exec';

    function renderTable(data, tableId, sectionType) {
      const [headers, ...rows] = data;
      const thead = document.querySelector(`#${tableId} thead`);
      const tbody = document.querySelector(`#${tableId} tbody`);
      thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join('') + "<th>Actions</th></tr>";

      // 🗂️ Sort for Weekly Status Table
      if (sectionType === 'weeklyStatus') {
        rows.sort((a, b) => {
          const weekA = parseInt(a[0].match(/\d+/)) || 0;
          const weekB = parseInt(b[0].match(/\d+/)) || 0;

          if (weekA !== weekB) return weekA - weekB;

          // Assuming Zone is at index 1
          return a[1].localeCompare(b[1]);
        });
      }

      // Sorting for Meetings by Date
      const dateColumnIndex = headers.indexOf('Meeting Date');
      rows.sort((a, b) => {
        const parseDate = (value) => {
          if (value instanceof Date) return value;
          if (typeof value === 'number') return new Date(Math.round((value - 25569) * 86400 * 1000));
          if (typeof value === 'string') {
            if (/^\d{4}-\d{2}-\d{2}T/.test(value)) return new Date(value);
            if (/^\d{2}-\d{2}-\d{4}$/.test(value)) {
              const [day, month, year] = value.split("-");
              return new Date(`${year}-${month}-${day}`);
            }
          }
          return new Date(value);
        };

        const dateA = parseDate(a[dateColumnIndex]);
        const dateB = parseDate(b[dateColumnIndex]);
        return dateA - dateB;
      });


      tbody.innerHTML = rows.map((row, i) => {
        const rowIndex = i + 2;
        const rowData = encodeURIComponent(JSON.stringify(row));

        const cells = row.map((c, j) => {
          // Format date to DD-MM-YYYY
          if (typeof c === "string" && /^\d{4}-\d{2}-\d{2}T/.test(c)) {
            const dateObj = new Date(c);
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const year = dateObj.getFullYear();
            return `<td>${day}-${month}-${year}</td>`;
          }

          // Photo URL display for meetings only
          if (sectionType === 'meetings' && j === row.length - 1 && typeof c === "string" && c.startsWith("http")) {
            return `<td><a href="${c}" target="_blank">View Photo</a></td>`;
          }

          // Multiline bullet formatting
          if (typeof c === "string" && c.includes('\n')) {
            const lines = c.split(/\r?\n/).filter(line => line.trim() !== '');
            const listItems = lines.map(item => {
              const cleanItem = item.trim().replace(/^\d+\.\s*/, '');
              return `<li>${cleanItem}</li>`;
            }).join('');
            return `<td><ol style="padding-left: 18px; margin: 0;">${listItems}</ol></td>`;
          }

          return `<td>${c}</td>`;
        }).join('');

        const editFunc = sectionType === 'meetings' ? 'editMeeting' :
          sectionType === 'weeklyStatus' ? 'editStatus' : 'editAction';
        const deleteFunc = sectionType === 'meetings' ? 'deleteMeeting' :
          sectionType === 'weeklyStatus' ? 'deleteStatus' : 'deleteAction';

        return `<tr>${cells}<td>
      <button onclick="${editFunc}(${rowIndex}, this)">Edit</button>
      <button onclick="${deleteFunc}(${rowIndex})">Delete</button>
      <input type="hidden" value="${rowData}">
    </td></tr>`;
      }).join('');
    }


    function fetchData() {
      fetch(scriptURL + '?sheet=Meetings').then(res => res.json()).then(data => renderTable(data, 'meeting-table', true));
      fetch(scriptURL + '?sheet=Action Items').then(res => res.json()).then(data => renderTable(data, 'action-table', false));
      fetch(scriptURL + '?sheet=Weekly Status').then(res => res.json()).then(data => renderTable(data, 'weekly-status-table', 'weeklyStatus'));
    }

    function editMeeting(row, btn) {
      const data = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input').value));
      const form = document.forms['meeting-form'];
      form.reset();
      form.row.value = row;
      const keys = ['meetingId', 'meetingDate', 'zone', 'district', 'coldRoom', 'meetingTitle', 'conductedBy', 'attendees', 'meetingAgenda', 'meetingDiscussion', 'photoUrl'];
      keys.forEach((k, i) => form[k].value = data[i]);
      document.getElementById('action-meetingId').value = data[0];
      document.getElementById('meeting-mode').innerText = "Mode: Editing Meeting (Row " + row + ")";
    }

    function editStatus(row, btn) {
      const data = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input').value));
      const form = document.forms['weekly-status-form'];
      form.reset();
      form.row.value = row;

      const keys = ['weekInfo', 'zone', 'district', 'currentWeekUpdate', 'nextWeekUpdate'];
      keys.forEach((k, i) => form[k].value = data[i]);

      document.getElementById('status-mode').innerText = "Mode: Editing Status (Row " + row + ")";
    }


    function deleteMeeting(row) {
      if (confirm("Delete this meeting?")) postData({ action: "delete_meeting", row }, fetchData);
    }

    function deleteStatus(row) {
      if (confirm("Delete this status entry?")) {
        postData({ action: "delete_status", row }, fetchWeeklyStatus);
      }
    }

    function editAction(row, btn) {
      const data = JSON.parse(decodeURIComponent(btn.parentElement.querySelector('input').value));
      const form = document.forms['action-form'];
      form.reset();
      form.row.value = row;
      const keys = ['meetingId', 'actionItem', 'assignedTo', 'deadline', 'status'];
      keys.forEach((k, i) => form[k].value = data[i]);
      document.getElementById('action-mode').innerText = "Mode: Editing Action Item (Row " + row + ")";
    }

    function deleteStatus(row) {
      if (confirm("Delete this status entry?")) {
        postData({ action: "delete_status", row }, fetchWeeklyStatus);
      }
    }


    function postData(data, callback) {
      fetch(scriptURL, { method: 'POST', body: JSON.stringify(data) })
        .then(res => res.text()).then(msg => { alert(msg); callback(); });
    }

    function renderWeeklyStatus(data) {
      const [headers, ...rows] = data;
      const thead = document.querySelector("#weekly-status-table thead");
      const tbody = document.querySelector("#weekly-status-table tbody");
      thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join('') + "</tr>";
      tbody.innerHTML = rows.map(row => "<tr>" + row.map(c => `<td>${c}</td>`).join('') + "</tr>").join('');
    }

    function fetchWeeklyStatus() {
      fetch(scriptURL + "?sheet=Weekly Status")
        .then(res => res.json())
        .then(data => renderTable(data, 'weekly-status-table', 'weeklyStatus'));
    }

    function showSection(section) {
      const sections = ['meetings', 'weeklyStatus', 'dummy2', 'dummy3', 'dummy4'];
      sections.forEach(s => {
        const el = document.getElementById(`${s}-section`);
        el.style.display = (s === section) ? 'block' : 'none';
      });

      document.getElementById('main-heading').style.display = (section === 'meetings') ? 'block' : 'none';

      // Only fetch when Weekly Status section is clicked
      if (section === "weeklyStatus") {
        fetchWeeklyStatus();
      }
    }

    // Weekly Status Logic
    const weeklyForm = document.getElementById('weekly-status-form');
    const statusList = document.getElementById('weekly-status-list');

    weeklyForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const weekInfo = weeklyForm.weekInfo.value;
      const summary = weeklyForm.statusSummary.value;

      const statusItem = document.createElement('div');
      statusItem.className = 'status-item';
      statusItem.style.border = '1px solid #ccc';
      statusItem.style.padding = '10px';
      statusItem.style.margin = '10px 0';
      statusItem.style.borderRadius = '5px';
      statusItem.style.textAlign = 'left';

      statusItem.innerHTML = `<strong>${weekInfo}</strong><p>${summary.replace(/\n/g, '<br>')}</p>`;

      statusList.prepend(statusItem);

      weeklyForm.reset();
    });

    document.getElementById('weekly-status-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const isEdit = form.row.value && form.row.value.trim() !== "";
      formData.append("action", isEdit ? "edit_status" : "add_status");

      fetch(scriptURL, {
        method: 'POST',
        body: formData
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          form.reset();
          form.row.value = ""; // Clear row after save
          document.getElementById('status-mode').innerText = 'Mode: Add New Status';
          fetchWeeklyStatus();
        });
    });


    document.getElementById('meeting-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const isEdit = form.row.value && form.row.value.trim() !== "";
      formData.append("action", isEdit ? "edit_meeting" : "add_meeting");

      fetch(scriptURL, {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(resData => {
          alert(resData.message);
          if (resData.meetingId) {
            document.getElementById('meetingId').value = resData.meetingId;
            document.getElementById('action-meetingId').value = resData.meetingId;
          }
          fetchData();
          form.reset();
          document.getElementById('meeting-mode').innerText = 'Mode: Add New Meeting';
        });
    });

    document.getElementById('action-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const data = Object.fromEntries(new FormData(form).entries());
      data.action = data.row && data.row.trim() !== "" ? "edit_action" : "add_action";
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(msg => {
        alert("Action item processed.");
        form.reset();
        form.row.value = ""; // ✅ Reset the row value to avoid re-editing
        fetchData();
        document.getElementById('action-meetingId').value = data.meetingId;
        document.getElementById('action-mode').innerText = 'Mode: Add New Action Item';
      });
    });

    window.onload = function () {
      fetchData(); // Load table data, but don't show any section by default
      fetchWeeklyStatus(); // Load Weekly Status data on page load
    };
  </script>
</body>

</html>
